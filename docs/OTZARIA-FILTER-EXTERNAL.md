# סינון ספריות חיצוניות באוצריא

## סקירה
הוסרו ספריות חיצוניות (HebrewBooks ואוצר החכמה) מהאפליקציה, אבל ניתן למצוא אותן על ידי חיפוש ספציפי של שם הקטגוריה.

---

## הדרישה
1. ✅ **לא להציג** את הקטגוריות החיצוניות בעץ הספרייה
2. ✅ **לא להציג** ספרים מקטגוריות חיצוניות בחיפוש רגיל
3. ✅ **לאפשר חיפוש ספציפי** - אם מישהו יחפש את שם הקטגוריה, הספרים יופיעו

---

## הפתרון

### 1. הסתרת קטגוריות מהעץ
**קובץ:** `src/utils/otzariaIntegration.js`

הקטגוריות החיצוניות לא מופיעות בעץ הספרייה:
```javascript
// סנן קטגוריות חיצוניות מהעץ
const filteredCategories = rootCategories.filter(category => {
  const isExternal = isExternalCategory(category.title);
  return !isExternal;
});
```

---

### 2. סינון חכם בחיפוש
**קובץ:** `src/utils/otzariaDB.js`

הספרים מסוננים, אלא אם מחפשים ספציפית את שם הקטגוריה:
```javascript
searchBooks(query) {
  // בדוק אם מחפשים ספציפית את שם הקטגוריה החיצונית
  const queryLower = query.toLowerCase();
  const searchingForExternalCategory = 
    queryLower.includes('hebrewbooks') ||
    queryLower.includes('היברו-בוקס') ||
    queryLower.includes('אוצר החכמה');
  
  // אם מחפשים את שם הקטגוריה, החזר הכל
  if (searchingForExternalCategory) {
    return results;
  }
  
  // אחרת, סנן ספרים מקטגוריות חיצוניות
  return results.filter(book => !isExternal(book.categoryTitle));
}
```

---

### 3. הסתרת שם הקטגוריה בתצוגה
**קובץ:** `src/components/SearchAutocomplete.jsx`

שם הקטגוריה לא מוצג אם היא חיצונית:
```javascript
{file.type === 'otzaria' && file.categoryTitle && !isExternalCategory(file.categoryTitle) && (
  <div className="autocomplete-meta">
    <span className="autocomplete-category">
      📚 {file.categoryTitle}
    </span>
  </div>
)}
```

---

## איך זה עובד?

### דוגמה 1: חיפוש רגיל "אבות"
```
שאילתה: "אבות"
תוצאות:
📖 אבות דרבי נתן (מקטגוריה רגילה)
   📚 מדרש
📖 מסכת אבות (מקטגוריה רגילה)
   📚 משנה

❌ לא מופיע: אבות על בנים (מהיברו-בוקס)
```

### דוגמה 2: חיפוש ספציפי "היברו-בוקס"
```
שאילתה: "היברו-בוקס"
תוצאות:
📖 ספר 1 מהיברו-בוקס
   (ללא שם קטגוריה)
📖 ספר 2 מהיברו-בוקס
   (ללא שם קטגוריה)

✅ מופיעים כי חיפשנו ספציפית את שם הקטגוריה
```

### דוגמה 3: חיפוש "אבות היברו-בוקס"
```
שאילתה: "אבות היברו-בוקס"
תוצאות:
📖 אבות על בנים
   (ללא שם קטגוריה)

✅ מופיע כי החיפוש כולל את שם הקטגוריה
```

---

## מה מסונן?

### קטגוריות שמסוננות:
- ✅ HebrewBooks / היברו-בוקס / היברו בוקס
- ✅ Hebrew Books
- ✅ אוצר החכמה / אוצר חכמה

### איפה מסוננות:
1. ✅ **עץ הספרייה** - הקטגוריות לא מופיעות
2. ✅ **חיפוש רגיל** - ספרים מקטגוריות אלה לא מופיעים
3. ✅ **שם קטגוריה** - לא מוצג בתוצאות

### מתי לא מסוננות:
1. ✅ **חיפוש ספציפי** - כשמחפשים את שם הקטגוריה עצמה

---

## יתרונות

### חוויית משתמש
- 🎯 **נקי** - לא רואים ספרים לא רלוונטיים
- 🎯 **גמישות** - עדיין אפשר למצוא אם צריך
- 🎯 **אינטואיטיבי** - חיפוש ספציפי מחזיר תוצאות

### טכני
- ⚡ **ביצועים** - פחות תוצאות בחיפוש רגיל
- ⚡ **גמישות** - קל לשנות את רשימת הקטגוריות
- ⚡ **תחזוקה** - לוגיקה ברורה

---

## בדיקה

### בדיקה 1: עץ הספרייה
1. פתח תיקיית "אוצריא"
2. ✅ ודא שלא מופיעות: HebrewBooks, אוצר החכמה

### בדיקה 2: חיפוש רגיל
1. חפש "אבות"
2. ✅ לא אמורים להופיע ספרים מהיברו-בוקס
3. ✅ רק ספרים מקטגוריות רגילות

### בדיקה 3: חיפוש ספציפי
1. חפש "היברו-בוקס"
2. ✅ ספרים מהקטגוריה אמורים להופיע
3. ✅ שם הקטגוריה לא מוצג

### בדיקה 4: חיפוש משולב
1. חפש "אבות היברו-בוקס"
2. ✅ ספרים מהיברו-בוקס שיש בהם "אבות" אמורים להופיע

---

## קבצים ששונו

1. `src/utils/otzariaIntegration.js`
   - סינון קטגוריות מהעץ

2. `src/utils/otzariaDB.js`
   - סינון חכם ב-`searchBooks()`
   - זיהוי חיפוש ספציפי לקטגוריה

3. `src/components/SearchAutocomplete.jsx`
   - הסתרת שם קטגוריה חיצונית

---

תאריך: 18 פברואר 2026
