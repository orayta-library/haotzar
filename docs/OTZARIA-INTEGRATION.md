# אינטגרציה של אוצריא

## סקירה כללית

התוכנה תומכת כעת בקריאה ישירה ממסד הנתונים של אוצריא (`seforim.db`). הספרים מאוצריא מוצגים בספרייה הרגילה תחת תיקייה וירטואלית "אוצריא" עם מבנה היררכי מלא של קטגוריות וספרים.

## מבנה הקבצים

### קבצים חדשים שנוספו:

1. **`src/utils/otzariaDB.js`** - מודול לקריאה ממסד הנתונים
   - פתיחת חיבור ל-DB
   - קריאת קטגוריות, ספרים ושורות טקסט
   - חיפוש בספרים
   - תמיכה ב-Electron (דרך IPC)

2. **`src/utils/otzariaIntegration.js`** - אינטגרציה עם הספרייה
   - בניית עץ קבצים וירטואלי מהקטגוריות והספרים
   - המרת ספרי אוצריא ל"קבצים וירטואליים"

3. **`src/components/OtzariaViewer.jsx`** - קומפוננטה להצגת ספרים
   - תצוגת טקסט עם תוכן עניינים
   - פגינציה (100 שורות לעמוד)
   - ניווט לשורות ספציפיות
   - תמיכה בהדגשת תוצאות חיפוש

4. **`src/components/OtzariaViewer.css`** - עיצוב הקומפוננטה

### קבצים ששונו:

1. **`src/App.jsx`**
   - פתיחת מסד הנתונים בעת טעינת האפליקציה
   - תמיכה בפתיחת ספרי אוצריא בכרטיסיות
   - הצגת אייקון מתאים לספרי אוצריא

2. **`src/components/LibrarySidebar.jsx`**
   - הוספת תיקיית אוצריא לעץ הקבצים
   - תמיכה בקבצים וירטואליים

3. **`electron/preload.js`**
   - פונקציות לפתיחה וקריאה ממסד הנתונים
   - `openOtzariaDB()` - פתיחת החיבור
   - `queryOtzariaDB()` - ביצוע שאילתות
   - `closeOtzariaDB()` - סגירת החיבור

## איך זה עובד?

### 1. מיקום קובץ ה-DB

הקובץ צריך להיות ב:
```
books/אוצריא/seforim.db
```

### 2. פתיחת מסד הנתונים

בעת טעינת האפליקציה, המערכת מנסה לפתוח את קובץ ה-DB:
- אם הקובץ קיים - נפתח חיבור
- אם לא - האפליקציה ממשיכה לעבוד רגיל ללא אוצריא

### 3. בניית העץ

המערכת קוראת את הקטגוריות והספרים ובונה עץ היררכי:
```
אוצריא/
├── תנ"ך/
│   ├── תורה/
│   │   ├── בראשית
│   │   ├── שמות
│   │   └── ...
│   └── נביאים/
├── משנה/
├── תלמוד/
└── ...
```

### 4. פתיחת ספר

כשלוחצים על ספר:
1. נפתחת כרטיסייה חדשה עם `OtzariaViewer`
2. הקומפוננטה טוענת את השורות הראשונות (100)
3. מוצג תוכן עניינים (אם קיים)
4. ניתן לנווט בין עמודים

## מבנה מסד הנתונים

### טבלאות עיקריות:

- **`category`** - קטגוריות (תנ"ך, משנה, תלמוד...)
  - `id`, `parentId`, `title`, `level`, `orderIndex`

- **`book`** - ספרים
  - `id`, `categoryId`, `title`, `totalLines`, `hasNekudot`, `hasTeamim`

- **`line`** - שורות טקסט
  - `id`, `bookId`, `lineIndex`, `content`, `heRef`

- **`tocEntry`** - תוכן עניינים
  - `id`, `bookId`, `parentId`, `textId`, `level`, `lineIndex`

- **`tocText`** - טקסטים של תוכן עניינים
  - `id`, `text`

## תכונות

✅ הצגת ספרים בהיררכיה מלאה  
✅ תוכן עניינים אינטראקטיבי  
✅ פגינציה חכמה (לא טוען את כל הספר)  
✅ חיפוש בספרים (מוכן לעתיד)  
✅ אינטגרציה מלאה עם הספרייה הקיימת  
✅ תמיכה בכרטיסיות מרובות  
✅ תמיכה ב-Split View  

## הרחבות עתידיות

- [ ] תמיכה ב-Tauri (נדרש להוסיף פונקציות ב-Rust)
- [ ] חיפוש מלא בכל ספרי אוצריא
- [ ] אינדקס חיפוש ל-Meilisearch
- [ ] הדגשת תוצאות חיפוש
- [ ] סימניות בספרי אוצריא
- [ ] הערות אישיות

## בעיות ידועות

- כרגע עובד רק ב-Electron (לא Tauri)
- אין עדיין אינטגרציה עם מנוע החיפוש
- לא ניתן לפתוח קישורים בין ספרים (links)

## דרישות

- `better-sqlite3` - כבר מותקן בפרויקט
- קובץ `seforim.db` בתיקייה `books/אוצריא/`
